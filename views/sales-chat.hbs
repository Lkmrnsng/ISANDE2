
<div class="chat-container">
    <div class="sidebar">
        <h2>Active Requests</h2>
        <div class="request-list">
            {{#each requests}}
            <div class="request-item {{#if isActive}}active{{/if}}" data-request-id="{{requestID}}">
                <div class="request-header">
                    <span>Request #{{requestID}}</span>
                    <span class="customer-name">{{customerName}}</span>
                </div>
                <div class="request-details">
                    <span>Date: {{formatDate2 requestDate}}</span>
                    <span>Status: {{status}}</span>
                </div>
            </div>
            {{/each}}
        </div>
    </div>

    <div class="chat-main">
        <div class="chat-header">
            {{#if activeRequest}}
            <div class="customer-info">
                <h3>Chat with {{activeRequest.customerName}}</h3>
                <span>Request #{{activeRequest.requestID}}</span>
            </div>
            {{/if}}
        </div>

        <div class="chat-content">
            <div class="chat-messages" id="chatMessages">
                {{#each messages}}
                <div class="message {{#if (eq ../userId senderID)}}sales{{else}}customer{{/if}}">
                    <div class="message-content">
                        {{message}}
                    </div>
                    <div class="message-time">{{formatDate2 date}}</div>
                </div>
                {{/each}}
            </div>

            <div class="order-details">
                <h4>Order Details</h4>
                <select id="orderDateSelect">
                    {{#each activeRequest.orders}}
                    <option value="{{OrderID}}">{{formatDate2 deliveryDate}}</option>
                    {{/each}}
                </select>

                <div class="order-form">
                    <div class="form-group">
                        <label>Delivery Date</label>
                        <input type="date" id="deliveryDate" value="{{selectedOrder.deliveryDate}}">
                    </div>
                    <div class="form-group">
                        <label>Time Range</label>
                        <select id="timeRange">
                            <option value="Morning" {{#if (eq selectedOrder.deliveryTimeRange "Morning")}}selected{{/if}}>Morning</option>
                            <option value="Afternoon" {{#if (eq selectedOrder.deliveryTimeRange "Afternoon")}}selected{{/if}}>Afternoon</option>
                            <option value="Evening" {{#if (eq selectedOrder.deliveryTimeRange "Evening")}}selected{{/if}}>Evening</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="orderStatus">
                            <option value="Waiting Approval" {{#if (eq selectedOrder.status "Waiting Approval")}}selected{{/if}}>Waiting Approval</option>
                            <option value="Preparing" {{#if (eq selectedOrder.status "Preparing")}}selected{{/if}}>Preparing</option>
                            <option value="Dispatched" {{#if (eq selectedOrder.status "Dispatched")}}selected{{/if}}>Dispatched</option>
                            <option value="Delivered" {{#if (eq selectedOrder.status "Delivered")}}selected{{/if}}>Delivered</option>
                            <option value="Cancelled" {{#if (eq selectedOrder.status "Cancelled")}}selected{{/if}}>Cancelled</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Address</label>
                        <textarea id="deliveryAddress">{{selectedOrder.deliveryAddress}}</textarea>
                    </div>
                    <div class="form-group">
                        <label>Customizations</label>
                        <textarea id="customizations">{{selectedOrder.customizations}}</textarea>
                    </div>
                    <div class="button-group">
                        <button id="saveCurrentOrder">Save for this order</button>
                        <button id="saveAllOrders">Save for all orders</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="chat-input">
            <textarea id="messageInput" placeholder="Type your message..."></textarea>
            <button id="sendMessage">Send</button>
        </div>
    </div>
</div>

<script src="/js/chat.js"></script>