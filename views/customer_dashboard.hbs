<div class="sidebar">
    <h2>Main Menu</h2>
    <ul>
        <li><a href="/my-requests">My Requests</a></li>
        <li><a href="/my-orders">My Orders</a></li>
        <li><a href="/chats">Chats</a></li>
        <li><a href="/cancel-order">Cancel Orders</a></li>
        <li><a href="/account">Account</a></li>
    </ul>
</div>

<div class="main-content">
    <div class="requests-list">
        <h1>My Requests</h1>
        <div class="search-bar">
            <input type="text" placeholder="Search...">
        </div>
        <table>
            <thead>
                <tr>
                    <th>Request ID</th>
                    <th>Status</th>
                    <th>Date/s</th>
                    <th>Items</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {{#each requests}}
                <tr class="request-row" 
                    data-deliveriesCount="{{this.deliveriesCount}}" 
                    data-deliveryDates='{{json this.deliveryDates}}'
                    data-totalItemsBreakdown='{{json this.totalItemsBreakdown}}'>
                    <td>{{this.requestID}}</td>
                    <td>{{this.status}}</td>
                    <td>{{formatDates this.deliveryDates}}</td>
                    <td>{{this.itemNames}}</td>
                    <td>View Details</td>
                </tr>
                {{/each}}
            </tbody>
        </table>
        <button class="place-request-btn">Place a Request</button>
    </div>

    <div class="request-details">
        <h2>Request Details</h2>    
        <p><strong>Number of Deliveries:</strong> <span id="deliveriesCount"></span></p>
        <p><strong>Delivery Dates:</strong> <span id="deliveryDates"></span></p>
        <p><strong>Total Items Breakdown:</strong> <span id="totalItemsBreakdown"></span></p>
        <button class="give-feedback-btn">Give Feedback</button>
    </div>
</div>

<script>
    document.querySelectorAll('.request-row').forEach(row => {
        row.addEventListener('click', function() {
            const deliveriesCount = this.dataset.deliveriescount;
            const deliveryDates = JSON.parse(this.dataset.deliverydates); // Parse delivery dates
            const totalItemsBreakdown = JSON.parse(this.dataset.totalitemsbreakdown); // Parse items breakdown

            // Log to debug (optional)
            console.log("Clicked request details: ", {
                deliveriesCount,
                deliveryDates,
                totalItemsBreakdown
            });

            // Update the request details section
            document.getElementById('deliveriesCount').textContent = deliveriesCount;
            document.getElementById('deliveryDates').textContent =  deliveryDates.join('| ');
            document.getElementById('totalItemsBreakdown').textContent = totalItemsBreakdown
                .map(item => `Item ID: ${item.itemID}, Quantity: ${item.quantity}`)
                .join(', ');

            // Optionally highlight the selected row
            document.querySelectorAll('.request-row').forEach(r => r.classList.remove('selected'));
            this.classList.add('selected');
        });
    });
</script>
